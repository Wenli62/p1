<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>{{option_a}} vs {{option_b}}!</title>
    <base href="/index.html">
    <meta name = "viewport" content = "width=device-width, initial-scale = 1.0">
    <meta name="keywords" content="docker-compose, docker, stack">
    <meta name="author" content="Tutum dev team">
    <link rel='stylesheet' href="{{ url_for('static',filename='stylesheets/style.css') }}" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  </head>
  <body>
    <div id="content-container">
      <div id="content-container-center">
        <h3>{{option_a}} vs {{option_b}}!</h3>
        
        <!-- Form to hold the vote selection -->
        <form id="choice" name="form">
          <button id="a" type="button" class="a" onclick="selectVote('a')">{{ option_a }}</button>
          <button id="b" type="button" class="b" onclick="selectVote('b')">{{ option_b }}</button>
          <input type="hidden" id="selected_vote" name="vote">
          <button id="submit" type="button" class="submit" onclick="submitVote()" disabled>Submit</button>
        </form>
        

        <div id="tip">(Tip: you can change your vote before submitting)</div>
        <div id="hostname">Processed by container ID {{hostname}}</div>
      </div>
    </div>

    <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <script>
      let selectedVote = null; // Store selected vote
    
      function selectVote(option) {
        selectedVote = option;
    
        // Update UI
        document.getElementById("a").innerHTML = "{{option_a}}";
        document.getElementById("b").innerHTML = "{{option_b}}";
        document.getElementById("a").style.opacity = "1";
        document.getElementById("b").style.opacity = "1";
    
        if (option === 'a') {
          document.getElementById("a").innerHTML = "{{option_a}} <i class='fa fa-check-circle'></i>";
          document.getElementById("a").style.opacity = "0.5";
        } else {
          document.getElementById("b").innerHTML = "{{option_b}} <i class='fa fa-check-circle'></i>";
          document.getElementById("b").style.opacity = "0.5";
        }
    
        document.getElementById("submit").disabled = false; // Enable submit button
      }
    
      async function submitVote() {
        if (!selectedVote) {
          alert("Please select an option before submitting.");
          return;
        }
    
        const voteData = {
          // id: String(Date.now()),  // Unique ID (could be improved)
          user_input: selectedVote === 'a' ? "{{option_a}}" : "{{option_b}}"
          // vote_time: new Date().toISOString(),
        };
    
        try {
          const response = await fetch('/vote', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(voteData),
          });
    
          const result = await response.json();
          console.log("Vote submitted:", result);
          alert("Vote successfully submitted!");
        } catch (error) {
          console.error("Error submitting vote:", error);
          alert("Failed to submit vote.");
        }
      }
    </script>
    
    
  </body>
</html>
